# 项目技术路线图

> AI 聊天机器人的技术架构和长期发展规划
> 最后更新：2026-01-12

---

## 当前版本：v2.0.0

**核心能力**：
- ✅ 双 AI 模型集成（GLM-4、DeepSeek）
- ✅ 流式响应（SSE 打字机效果）
- ✅ 多轮对话上下文记忆
- ✅ 对话历史持久化
- ✅ 配置验证系统

---

## 技术架构

### 整体架构

```
┌─────────────────────────────────────┐
│         用户浏览器                  │
│  ┌───────────────────────────────┐  │
│  │  前端 (public/index.html)     │  │
│  │  - 消息界面                   │  │
│  │  - 虚拟形象                   │  │
│  │  - 对话历史 (localStorage)    │  │
│  └───────────────────────────────┘  │
└─────────────┬───────────────────────┘
              │ HTTPS
              ▼
┌─────────────────────────────────────┐
│      后端服务器 (Node.js)           │
│  ┌───────────────────────────────┐  │
│  │  Express.js API 服务          │  │
│  │  - /api/chat (普通/流式)      │  │
│  │  - /api/models                │  │
│  │  - /api/health                │  │
│  │  - 配置验证                   │  │
│  └───────────────────────────────┘  │
└─────────────┬───────────────────────┘
              │ HTTPS
              ▼
┌─────────────────────────────────────┐
│        AI 服务提供商                 │
│  - GLM-4 (智谱AI)                   │
│  - DeepSeek Chat                    │
└─────────────────────────────────────┘
```

### API 设计

**核心接口**：
- `POST /api/chat` - 普通聊天接口
- `POST /api/chat/stream` - 流式聊天接口（SSE）
- `GET /api/health` - 健康检查
- `GET /api/models` - 可用模型列表
- `POST /api/set-model` - 切换默认模型
- `GET /api/config` - 配置信息

**流式响应实现**：
- 后端：Server-Sent Events (SSE)
- 前端：ReadableStream API
- 支持中断和错误处理

### 配置管理

```
config.js                  # 后端配置（服务器、AI、安全）
├── validators.js          # 配置验证器
└── frontend.config.js     # 前端配置源
        ↓
scripts/generate-config.js # 配置生成脚本
        ↓
public/config.js          # 前端配置（自动生成）
```

**配置验证**：
- 启动时自动验证
- 类型检查和范围验证
- 友好的错误提示
- 配置错误时拒绝启动

---

## 技术栈

### 当前技术栈

| 层级 | 技术 | 用途 |
|------|------|------|
| **前端** | HTML5 + CSS3 + 原生 JavaScript | 用户界面 |
| **后端** | Node.js 18 + Express.js | API 服务 |
| **HTTP 客户端** | axios | AI API 调用 |
| **配置管理** | dotenv | 环境变量 |
| **安全** | express-rate-limit | 速率限制 |
| **AI 服务** | GLM-4、DeepSeek | 智能对话 |

### 建议技术栈（长期）

| 层级 | 建议 | 收益 |
|------|------|------|
| **前端框架** | Vue 3 / React | 组件化、状态管理 |
| **类型系统** | TypeScript | 类型安全 |
| **构建工具** | Vite | 开发体验优化 |
| **状态管理** | Pinia / Zustand | 全局状态 |
| **组件库** | Naive UI / Shadcn UI | UI 一致性 |
| **后端框架** | NestJS（可选） | 架构规范化 |
| **ORM** | Prisma | 数据库抽象 |
| **数据库** | PostgreSQL / MongoDB | 数据持久化 |
| **缓存** | Redis | 性能优化 |
| **日志** | Winston / Pino | 日志管理 |

---

## 部署方案

### 推荐架构

```
┌─────────────────────────────────────┐
│         Nginx (反向代理)            │
│  ├─ 静态文件托管（/ → index.html）  │
│  ├─ SSL 终止（Let's Encrypt）       │
│  └─ API 反向代理（/api/* → Node）   │
└─────────────┬───────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│      PM2 进程管理                    │
│  └─ Node.js 应用                    │
└─────────────────────────────────────┘
```

### 部署选项对比

| 方案 | 成本 | 优点 | 缺点 | 适用场景 |
|------|------|------|------|----------|
| **腾讯云轻量服务器** | ¥60-100/月 | 完全控制、成本可控 | 需要运维 | **生产环境推荐** |
| **Vercel (Hobby)** | 免费 | 自动部署、零配置 | 免费额度有限 | 个人项目、低流量 |
| **Vercel (Pro)** | $20/月 | Serverless Functions | 成本较高 | 商业项目 |
| **自建服务器** | ¥50-200/月 | 灵活性最高 | 运维工作量大 | 高可用要求 |

### 成本估算

**假设场景**：每天 100 个用户，每人 10 轮对话

```
每天消息数: 2,000 条
每天 tokens: 200,000
每月 tokens: 6,000,000

GLM-4: 6M tokens × ¥0.008 = ¥48/月
DeepSeek: 6M tokens × ¥0.001 = ¥6/月

总计：约 ¥50-100/月
```

---

## 长期规划

### 阶段 3：架构升级（3-6 个月）

#### 后端优化

**请求缓存**：
- 相同问题的缓存机制
- 减少 API 调用成本
- 提升响应速度

**日志系统**：
- Winston / Pino 集成
- 结构化日志
- 日志轮转和归档

**数据库集成**（可选）：
- PostgreSQL / MongoDB
- 用户认证系统
- 对话历史云端存储

#### 前端优化

**框架升级**（可选）：
- Vue 3 / React 迁移
- TypeScript 引入
- Vite 构建工具

**状态管理**：
- Pinia / Zustand
- 统一状态管理
- 更好的可维护性

**测试覆盖**：
- Vitest / Jest
- 单元测试
- E2E 测试

#### 部署优化

**容器化**：
- Docker 镜像
- docker-compose 编排

**CI/CD**：
- GitHub Actions
- 自动测试
- 自动部署

**监控和告警**：
- 应用性能监控
- 错误追踪
- 日志聚合

---

## 功能模块规划

### 高级功能（长期）

| 模块 | 功能 | 技术方案 | 优先级 |
|------|------|----------|--------|
| **富媒体对话** | 图片生成和显示 | GLM-4V、DALL-E | P1 |
| **文件分析** | PDF、Word、Excel | 文件解析 + AI | P1 |
| **语音交互** | 语音输入/输出 | Web Speech API | P2 |
| **多会话管理** | 并发对话管理 | 会话管理器 | P1 |
| **智能建议** | 推荐问题、快速回复 | NLP 分析 | P2 |
| **协作功能** | 分享对话、评论 | 对话分享链接 | P2 |
| **浏览器插件** | 网页摘要、快速提问 | Chrome Extension | P3 |

### 虚拟形象系统

**当前状态**：
- ✅ Emoji 占位符
- ✅ 4 个预设角色
- ✅ 配置持久化

**未来扩展**：
- Lottie 动画集成（~50KB）
- 3D 模型支持（Three.js）
- 表情状态系统（开心、思考、惊讶）
- 用户自定义形象上传

详细说明：[AVATAR_GUIDE.md](AVATAR_GUIDE.md)

---

## 性能目标

### 当前性能

| 指标 | 目标 | 当前 |
|------|------|------|
| API 响应时间 | < 2 秒 | ✅ 达标 |
| 流式响应延迟 | < 500ms | ✅ 达标 |
| 渲染性能 | > 60 FPS | ✅ 达标 |

### 优化目标

| 指标 | 当前 | 目标 | 方案 |
|------|------|------|------|
| 首屏加载 | ~2 秒 | < 1 秒 | 代码分割、CDN |
| API 缓存命中率 | 0% | > 30% | Redis 缓存 |
| 并发支持 | ~100 用户 | > 1000 用户 | 负载均衡 |

---

## 相关文档

- 📊 **[实施进度](PROGRESS.md)** - 已完成和待办任务（短期 2-4 周）
- 🔧 **[搭建指南](SETUP.md)** - 本地开发环境配置
- 🎨 **[虚拟形象配置](AVATAR_GUIDE.md)** - 自定义虚拟形象

---

**文档维护**：定期更新以反映最新技术决策
**最后更新**：2026-01-12
